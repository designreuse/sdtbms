$(document).ready(function() {
	
	//New Employee button and dialog
    $("#btn_new_document_link").click(function() {
    	$('#btn_new_document_dialog').dialog('open');
		return true;
    });
    buildBasicCreateDialog('form_new_employee','btn_new_document_dialog',300,650,'&create=创建&employee.account.id=1');
    
    //New department button and dialog
    $("#btn_new_department_link").click(function() {
    	$('#btn_new_department_dialog').dialog('open');
		return true;
    });
    buildBasicCreateDialog('form_new_department','btn_new_department_dialog',150,650,"&create=创建");
    
  //New position button and dialog
    $("#btn_new_position_link").click(function() {
    	$('#btn_new_position_dialog').dialog('open');
		return true;
    });
    buildBasicCreateDialog('form_new_position','btn_new_position_dialog',150,650,"&create=创建");
    
    $('#submit_viewedit').submit(function(){
    	alert("abc");
    	return false;
    });
    
    
    $(".datepickerClass").datepicker({
    	changeMonth: true,
		changeYear: true
    });
    
    $("#form_function_list").submit(function() { 
    	alert("onsubmit");
        var name = $("#form_function_list input[checked=true]").attr("name");
        if(name == "viewedit"){
        	alert("clicked");
        }else{
        	alert("not found");
        }
        return false;
        // DO WORK
    });

    $("#form_function_list input[type=submit]").click(function() {
        $("input[type=submit]", $(this).parents("form")).removeAttr("clicked");
        $(this).attr("clicked", "true");
    });
 });

function clearFormTextBox(form){
//	alert("clearing");
	$('#'+form + ' input[type=text],select').each(function(){
//		alert($(this).val());
		$(this).val('');
	});
}

function buildBasicCreateDialog(formId, dialogId, width, height, extraParam){
	$("#"+dialogId).dialog({
		autoOpen: false,
		bgiframe: true,
		resizable: true,
		height:width,
		width:height,
		modal: true,
		overlay: {
			backgroundColor: '#000',
			opacity: 0.5
		},
		buttons: {
			'Create':function(){
					var form = $('#'+formId);
					var params = $('#'+formId).serialize() + extraParam;
					$.ajax({
						url:form.action,
						type:"post",
						dataType:'text',
						data:params,
						success:function(response){
							console.log("ajax response = "+response);
							$("#"+dialogId).dialog('close');
							alert(response);
							clearFormTextBox(formId);
//							location.reload();
						},
						error:function(response){
							alert("errors");
						}
					});
			},
			Cancel: function() {
				$(this).dialog('close');
			}
		}
	});
}

function deleteDepartment(dpid){
	alert("delete "+dpid);
	$.ajax({
		url:form.action,
		type:"post",
		dataType:'text',
		data:params,
		success:function(response){
			console.log("ajax response = "+response);
			$("#"+dialogId).dialog('close');
			alert(response);
			clearFormTextBox(formId);
		},
		error:function(response){
			alert("errors");
		}
	});
}

