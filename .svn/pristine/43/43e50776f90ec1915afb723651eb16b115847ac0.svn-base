package com.bus.stripes.actionbean;

import java.util.ArrayList;
import java.util.List;

import com.bus.dto.Contract;
import com.bus.dto.Employee;
import com.bus.services.HRBean;
import com.bus.util.SelectBoxOption;
import com.bus.util.SelectBoxOptions;

import net.sourceforge.stripes.action.ActionBean;
import net.sourceforge.stripes.action.ActionBeanContext;
import net.sourceforge.stripes.action.DefaultHandler;
import net.sourceforge.stripes.action.ForwardResolution;
import net.sourceforge.stripes.action.HandlesEvent;
import net.sourceforge.stripes.action.Resolution;
import net.sourceforge.stripes.action.StreamingResolution;
import net.sourceforge.stripes.integration.spring.SpringBean;

public class ContractActionBean implements  ActionBean{

	private MyActionBeanContext context;
	public MyActionBeanContext getContext() { return context; }
	public void setContext(ActionBeanContext context) { this.context = (MyActionBeanContext)context; }
	
	private HRBean bean;
	private List<Contract> contracts  = new ArrayList<Contract>();
	private Contract contract;
	private List<SelectBoxOption> contracttype = SelectBoxOptions.getContractType();
	
	private int pagenum;
	private int lotsize;
	private Long totalcount;
	
	public List<Contract> getContracts() {
		return contracts;
	}
	public void setContracts(List<Contract> contracts) {
		this.contracts = contracts;
	}

	public HRBean getBean() {
		return bean;
	}
	
	@SpringBean
	public void setBean(HRBean bean) {
		this.bean = bean;
	}

	
	
	private void initData(){
		if(pagenum <= 0 || lotsize <= 0){
			pagenum = 1;
			lotsize = 20;
		}
		setTotalcount(bean.countContracts()/lotsize +1);
		if(pagenum > totalcount)
			pagenum = Integer.parseInt(totalcount.toString());
		setContracts(bean.getContracts(pagenum, lotsize));
	}
	
	@DefaultHandler
	public Resolution defaultAction(){
		initData();
		return new ForwardResolution("/hr/contract.jsp");
	}
	
	@HandlesEvent(value="viewall")
	public Resolution viewall(){
		String id = context.getRequest().getParameter("targetId");
		setContracts(bean.getContractsByEmployeeId(Integer.parseInt(id)));
		return new ForwardResolution("/hr/viewcontracts.jsp");
	}
	
	@HandlesEvent(value="edit")
	public Resolution edit(){
		bean.updateContract(contract);
		return new StreamingResolution("text;charset=utf-8","合同修改成功");
	}
	
	@HandlesEvent(value="delete")
	public Resolution delete(){
		//
		//bean.removeContract(id);
		return new StreamingResolution("text;charset=utf-8","合同已经删除");
	}
	
	public Long getTotalcount() {
		return totalcount;
	}
	public void setTotalcount(long l) {
		this.totalcount = l;
	}
	public int getLotsize() {
		return lotsize;
	}
	public void setLotsize(int lotsize) {
		this.lotsize = lotsize;
	}
	public int getPagenum() {
		return pagenum;
	}
	public void setPagenum(int pagenum) {
		this.pagenum = pagenum;
	}
	public Contract getContract() {
		return contract;
	}
	public void setContract(Contract contract) {
		this.contract = contract;
	}
	public List<SelectBoxOption> getContracttype() {
		return contracttype;
	}
	public void setContracttype(List<SelectBoxOption> contracttype) {
		this.contracttype = contracttype;
	}
}
