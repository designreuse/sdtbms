<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="stripes" uri="http://stripes.sourceforge.net/stripes.tld" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="ss" uri="/WEB-INF/StripesSecurityManager.tld" %>
<stripes:layout-render name="../default.jsp">
	 <stripes:layout-component name="contents">
	 <style type="text/css">
		table.data thead tr th{
			border: 1px solid rgb(0, 0, 0);
			border-collapse:collapse;
			background-color:#616161;
			color:black;
			padding:5px;
			font-size:15pt;
			text-align:center;
		}
		table.data tbody tr td{
			border: 1px solid rgb(0, 0, 0);
			border-collapse:collapse;
			padding:5px;
			font-size:12pt;
			height:25px;
			vertical-align:middle;
			text-align:center;
		}
		table.data tr.alt{
			background-color:rgb(200,200,200);
		}
		table.data tbody tr:hover{
			background-color:yellow;
		}
		
	</style>
	<script type="text/javascript">
		$(document).ready(function(){
			$('#selectAll').click(function(){
				if(this.checked){
					$('#dataForm :checkbox').each(function(){
						this.checked = true;
					});
				}else{
					$('#dataForm :checkbox').each(function(){
						this.checked = false;
					});
				}
			});

			
			$('#dataForm').submit(function(){return false;});
			var formAction = $('#dataForm').attr('action');
			$('#approved').click(function(){
				if(!isSelection())
					return false;
				var serialize = $('#dataForm').serialize();
				$.ajax({
					url:formAction+"?approveAction=",
					data:serialize,
					success:function(response){
						var json = $.parseJSON(response);
						alert(json.msg);
						if(json.result=="1"){
							location.reload();
						}
					}
				});
			});
			
			$('#deny').click(function(){
				if(!isSelection())
					return false;
				var serialize = $('#dataForm').serialize();
				$.ajax({
					url:formAction+"?rejectAction=",
					data:serialize,
					success:function(response){
						var json = $.parseJSON(response);
						alert(json.msg);
						if(json.result=="1"){
							location.reload();
						}
					}
				});
			});

			$('#delete').click(function(){
				if(!isSelection())
					return false;
				var serialize = $('#dataForm').serialize();
				$.ajax({
					url:formAction+"?deleteApprovedAction=",
					data:serialize,
					success:function(response){
						var json = $.parseJSON(response);
						alert(json.msg);
						if(json.result=="1"){
							location.reload();
						}
					}
				});	
			});
			$("#searchDate").click(function(){
// 				alert("sdasd");
				var startdate = $('#startDate').val();
				var enddate  = $('#endDate').val();
				var link = $(this).next().val() + "&startDate="+startdate+"&endDate="+enddate;
				window.location = link;
			});
		});
		function isSelection(){
			var count = $('#dataForm input:checkbox:checked').length;
			if(count <= 0){
				alert("未选上任何项目");
				return false;
			}
			return true;
		}
	</script>
	  <div id="sub-nav"><div class="page-title">
			<h1>审核条例</h1>
		</div></div>
		
		<div id="page-layout"><div id="page-content">
			<div id="page-content-wrapper">
			
			
			
			<!-- Side bar ****************************************************************** -->
			<jsp:include page="/score/sidebar.jsp" />
			
			
			
		<!-- Side bar ****************************************************************** -->
				<!-- Start of main content -->
				<div id="rightcontent">
					<ss:secure roles="score_approve_items">
						<div style="height:40px;font-size:17pt;padding:5px;">
							<c:if test="${actionBean.mode == null || actionBean.mode == 0}">
								<a style="color:black;font-weight:bold;" href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action">待审核数(${actionBean.countWaitting }):</a>&nbsp;|&nbsp;
								<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=-1">已审核的项目</a>
							</c:if>
							<c:if test="${actionBean.mode < 0}">
								<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action">待审核数(${actionBean.countWaitting }):</a>&nbsp;|&nbsp;
								<a style="color:black;font-weight:bold;" href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=-1">已审核的项目</a>
							</c:if>
						</div>
						<div style="font-size:16pt;padding:5px;">
							<div>
<%-- 							<stripes:form beanclass="com.bus.stripes.actionbean.score.ScoreApproveActionBean" method="get"> --%>
								<c:set var="mode" value="0"  scope="page"/>
								<c:if test="${actionBean.mode < 0 }">
									<c:set var="mode" value="-1"  scope="page"/>
								</c:if>	
								<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=${mode}">今天</a>
<!-- 								<button name="selectPeriod" value="">今天</button> -->
								&nbsp;|&nbsp;
								<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=${mode}&selectPeriod=w">今周</a>
<!-- 								<button name="selectPeriod" value="w">今周</button> -->
								&nbsp;|&nbsp;
								<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=${mode}&selectPeriod=m">今月</a>
<!-- 								<button name="selectPeriod" value="m">今月</button> -->
								<c:if test="${actionBean.mode == null || actionBean.mode == 0}">
									&nbsp;|&nbsp;
									<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=${mode}&selectPeriod=a">全部</a>
<!-- 									<button name="selectPeriod" value="a">全部</button> -->
								</c:if>
								<c:if test="${actionBean.mode < 0 }">
									<br/>
									起始日期:<input type="text" id="startDate" name="startDate" class="datepickerClass"/>&nbsp;&nbsp;
									结束日期:<input type="text" id="endDate" name="endDate" class="datepickerClass"/>&nbsp;&nbsp;
									<button id='searchDate'>按时间段搜索</button><input type="hidden" value="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?mode=${mode}&selectPeriod=a"/>
								</c:if>
								<br/>
								<div style="padding:5px;color:red;font-weight:bold;">
									<c:if test="${actionBean.selectPeriod==null }">今天</c:if>
									<c:if test='${actionBean.selectPeriod== "w"}'>今周</c:if>
									<c:if test='${actionBean.selectPeriod== "m"}'>今月</c:if>
									<c:if test='${actionBean.mode == null && actionBean.selectPeriod== "a" }'>全部</c:if>
									<c:if test='${actionBean.selectPeriod== "a" && actionBean.mode < 0}'>时间段</c:if>
								</div>
<%-- 							</stripes:form> --%>
							</div>
						</div>
						
						<div>
							<stripes:form id="dataForm" beanclass="com.bus.stripes.actionbean.score.ScoreApproveActionBean">
							<table class="data">
								<thead>
									<tr>
										<th>全选<input type="checkbox" id="selectAll"/></th>
										<th>Id</th>
										<th>打分人</th>
										<th>受分员工</th>
										<th>职位</th>
										<th>日期</th>
										<th>分值</th>
										<th>条例编号</th>
										<th>条例详细</th>
									</tr>
								</thead>
								<tbody>
									<c:set var="count" value="0"  scope="page"/>
									<c:forEach items="${actionBean.displayList}" var="list" varStatus="loop">
										<c:if test="${count%2==0}">
											<tr class="alt">
										</c:if>
										<c:if test="${count%2!=0}">
											<tr>
										</c:if>
											<td><stripes:checkbox name="selected" value="${list.id }"/></td>
											<td>${list.id }</td>
											<td>${list.sender.employee.fullname }</td>
											<td>${list.receiver.employee.fullname }</td>
											<td>${list.receiver.employee.position.name }</td>
											<td>${list.scoredatestr }</td>
											<td>${list.score }</td>
											<td>${list.scoretype.reference }</td>
											<td>${list.scoretype.description}</td>
										</tr>
										<c:set var="count" value="${count + 1}" scope="page"/>
									</c:forEach>
								</tbody>
							</table>
							</stripes:form>
							<div>
								<c:if test="${actionBean.mode == null }">
									<button id="approved">通过</button>
									<button id="deny">拒绝</button>
								</c:if>
								<c:if test="${actionBean.mode < 0 }">
									<button id="delete">删除</button>
								</c:if>
							</div>
						</div>
					</ss:secure>
				</div>
				<!-- End of main content -->
			</div>
			<div class="clear"></div>
		</div>
	</div>
    </stripes:layout-component>
</stripes:layout-render>