<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="stripes" uri="http://stripes.sourceforge.net/stripes.tld" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="ss" uri="/WEB-INF/StripesSecurityManager.tld" %>
<stripes:layout-render name="../default.jsp">
	 <stripes:layout-component name="contents">
	 <style type="text/css">
		table.data thead tr th{
			border: 1px solid rgb(0, 0, 0);
			border-collapse:collapse;
			background-color:#616161;
			color:black;
			padding:5px;
			font-size:15pt;
			text-align:center;
		}
		table.data tbody tr td{
			border: 1px solid rgb(0, 0, 0);
			border-collapse:collapse;
			padding:5px;
			font-size:12pt;
			height:25px;
			vertical-align:middle;
			text-align:center;
		}
		table.data tr.alt{
			background-color:rgb(200,200,200);
		}
		table.data tbody tr:hover{
			background-color:yellow;
		}
		
	</style>
	<script type="text/javascript">
		$(document).ready(function(){
			$('#dataForm').submit(function(){return false;});
			var formAction = $('#dataForm').attr('action');
			$('#approved').click(function(){
				if(!isSelection())
					return false;
				var serialize = $('#dataForm').serialize();
				$.ajax({
					url:formAction+"?approveAction=",
					data:serialize,
					success:function(response){
						var json = $.parseJSON(response);
						alert(json.msg);
						if(json.result=="1"){
							location.reload();
						}
					}
				});
			});
			
			$('#deny').click(function(){
				if(!isSelection())
					return false;
				var serialize = $('#dataForm').serialize();
				$.ajax({
					url:formAction+"?rejectAction=",
					data:serialize,
					success:function(response){
						var json = $.parseJSON(response);
						alert(json.msg);
						if(json.result=="1"){
							location.reload();
						}
					}
				});
			});
		});
		function isSelection(){
			var count = $('#dataForm input:checkbox:checked').length;
			if(count <= 0){
				alert("未选上任何项目");
				return false;
			}
			return true;
		}
	</script>
	  <div id="sub-nav"><div class="page-title">
			<h1>审核条例</h1>
		</div></div>
		
		<div id="page-layout"><div id="page-content">
			<div id="page-content-wrapper">
			
			
			
			<!-- Side bar ****************************************************************** -->
			<jsp:include page="/score/sidebar.jsp" />
			
			
			
		<!-- Side bar ****************************************************************** -->
				<!-- Start of main content -->
				<div id="rightcontent">
					<ss:secure roles="score_approve_items">
						<div style="height:40px;font-size:17pt;padding:5px;">
							待审核数:${actionBean.countWaitting }
						</div>
						<div style="height:40px;font-size:16pt;padding:5px;">
							<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action">今天</a>&nbsp;|&nbsp;
							<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?selectPeriod=w">今周</a>&nbsp;|&nbsp;
							<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?selectPeriod=m">今月</a>&nbsp;|&nbsp;
							<a href="${pageContext.request.contextPath}/actionbean/ScoreApprove.action?selectPeriod=a">全部</a>
						</div>
						<div>
							<stripes:form id="dataForm" beanclass="com.bus.stripes.actionbean.score.ScoreApproveActionBean">
							<table class="data">
								<thead>
									<tr>
										<th></th>
										<th>Id</th>
										<th>员工</th>
										<th>职位</th>
										<th>日期</th>
										<th>分值</th>
										<th>条例编号</th>
										<th>条例详细</th>
									</tr>
								</thead>
								<tbody>
									<c:set var="count" value="0"  scope="page"/>
									<c:forEach items="${actionBean.displayList}" var="list" varStatus="loop">
										<c:if test="${count%2==0}">
											<tr class="alt">
										</c:if>
										<c:if test="${count%2!=0}">
											<tr>
										</c:if>
											<td><stripes:checkbox name="selected" value="${list.id }"/></td>
											<td>${list.id }</td>
											<td>${list.receiver.employee.fullname }</td>
											<td>${list.receiver.employee.position.name }</td>
											<td>${list.scoredatestr }</td>
											<td>${list.score }</td>
											<td>${list.scoretype.reference }</td>
											<td>${list.scoretype.description}</td>
										</tr>
										<c:set var="count" value="${count + 1}" scope="page"/>
									</c:forEach>
								</tbody>
							</table>
							</stripes:form>
							<div>
								<button id="approved">通过</button>
								<button id="deny">拒绝</button>
							</div>
						</div>
					</ss:secure>
				</div>
				<!-- End of main content -->
			</div>
			<div class="clear"></div>
		</div>
	</div>
    </stripes:layout-component>
</stripes:layout-render>