$(document).ready(function(){
	//New Item button and dialog
    $("#btn_new_item_link").click(function() {
    	$('#btn_new_item_dialog').dialog('open');
		return true;
    });
    buildNewItemDialog('form_new_item','btn_new_item_dialog',450,300,'&createscoretype=');
    
});


function buildNewItemDialog(formId, dialogId, width, height, extra){
	$("#"+dialogId).dialog({
		autoOpen: false,
		bgiframe: true,
		resizable: true,
		height:height,
		width:width,
		modal: true,
		overlay: {
			backgroundColor: '#000',
			opacity: 0.5
		},
		buttons: {
			'新建':function(){
					if(!scoreNewItemValidation(formId)){
						return;
					}
					var form = $('#'+formId);
					var params = $('#'+formId).serialize() + extra;
					$.ajax({
						url:form.action,
						type:"post",
						dataType:'text',
						data:params,
						success:function(response){
							$("#"+dialogId).dialog('close');
							alert(response);
							location.reload();
						},
						error:function(response){
							alert("errors");
						}
					});
			},
			'取消': function() {
				$(this).dialog('close');
			}
		}
	});
}

function scoreNewItemValidation(formId){
	var text = "";
	var valid = true;
	$('#'+formId).find('input').each(function(){
		if($(this).hasClass('required')){
			var value = $(this).val();
			if(value.trim() == ""){
				valid = false;
				var name = $(this).parent().prev().html();
				text += name + ",";
			}
		}
	});
	$('#'+formId).find('select').each(function(){
		if($(this).hasClass('required')){
			var value = $(this).val();
			if(value.trim() == ""){
				valid = false;
				var name = $(this).parent().prev().html();
				text += name + ",";
			}
		}
	});
	if(text != "")
		alert("请输入 " + text);
	return valid;
}